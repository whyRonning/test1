import{A as j,C as y,a as C,b as w,c as T,d as s,e as D,f as c,h as E,i as _,j as a,k as l,l as p,m as v,n as A,o as k,p as I,q as b,r as N,s as S,t as R,u,w as O,x}from"./chunk-LU7WRUGA.js";var d=class r{ngOnInit(){console.log("Component ngOnInit")}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=p({type:r,selectors:[["app-complete-auth"]],decls:1,vars:0,template:function(e,t){e&1&&u(0,`pidor
`)},encapsulation:2})};var P=new D("JWT_OPTIONS"),G=(()=>{class r{constructor(e=null){this.tokenGetter=e&&e.tokenGetter||function(){}}urlBase64Decode(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:{t+="==";break}case 3:{t+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(t)}b64decode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="";if(e=String(e).replace(/=+$/,""),e.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let m=0,f,n,H=0;n=e.charAt(H++);~n&&(f=m%4?f*64+n:n,m++%4)?i+=String.fromCharCode(255&f>>(-2*m&6)):0)n=t.indexOf(n);return i}b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this.b64decode(e),t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._decodeToken(t)):this._decodeToken(e)}_decodeToken(e){if(!e||e==="")return null;let t=e.split(".");if(t.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let i=this.urlBase64Decode(t[1]);if(!i)throw new Error("Cannot decode the token.");return JSON.parse(i)}getTokenExpirationDate(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._getTokenExpirationDate(t)):this._getTokenExpirationDate(e)}_getTokenExpirationDate(e){let t;if(t=this.decodeToken(e),!t||!t.hasOwnProperty("exp"))return null;let i=new Date(0);return i.setUTCSeconds(t.exp),i}isTokenExpired(e=this.tokenGetter(),t){return e instanceof Promise?e.then(i=>this._isTokenExpired(i,t)):this._isTokenExpired(e,t)}_isTokenExpired(e,t){if(!e||e==="")return!0;let i=this.getTokenExpirationDate(e);return t=t||0,i===null?!1:!(i.valueOf()>new Date().valueOf()+t*1e3)}getAuthScheme(e,t){return typeof e=="function"?e(t):e}}return r.\u0275fac=function(e){return new(e||r)(c(P))},r.\u0275prov=s({token:r,factory:r.\u0275fac}),r})();var h=class r{constructor(o){this.http=o;this._jwtHelper=new G}isAuthenticated=a(!1);userData=a(null);_jwtHelper;authGoogle(){}authDiscord(){}decodeToken(o){return this._jwtHelper.decodeToken(o)}getToken(){return this.http.get("http://localhost:8080/authorize/get-token").pipe(T(o=>{o.token&&localStorage.setItem("token",o.token)}))}authenticate(o,e){let t=new O().set("Authorization",e||"");return this.http.post("http://localhost:8080/authorize/game-account",{base64:o},{headers:t}).pipe(T(i=>{i.status==="ACCESS_GRANTED"&&(this.isAuthenticated.set(!0),this.userData.set(i.data))}))}static \u0275fac=function(e){return new(e||r)(c(x))};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};function J(r,o){r&1&&b(0,"app-complete-auth")}function F(r,o){if(r&1){let e=N();k(0,"button",0),S("click",function(){E(e);let i=R();return _(i.toDiscord())}),u(1,"\u0434\u0438\u0441\u043A\u043E\u0440\u0434"),I()}}var M=class r{constructor(o,e,t){this.router=o;this.authService=e;this.activatedRoute=t;this.isAuth=this.authService.isAuthenticated()}user=a(null);isAuth=!1;ngOnInit(){this.activatedRoute.params.pipe(w(o=>this.authService.getToken().pipe(C(()=>o.base64))),w(o=>{let e=localStorage.getItem("token")||null;return this.authService.authenticate(o,e)})).subscribe(o=>{this.user.set(o.data)})}toDiscord(){document.location.href="http://localhost:8080/oauth2/authorization/discord"}static \u0275fac=function(e){return new(e||r)(l(y),l(h),l(j))};static \u0275cmp=p({type:r,selectors:[["app-auth"]],decls:2,vars:1,consts:[[3,"click"]],template:function(e,t){e&1&&v(0,J,1,0,"app-complete-auth")(1,F,2,0,"button"),e&2&&A(t.isAuth?0:1)},dependencies:[d],encapsulation:2})};export{M as AuthComponent};
